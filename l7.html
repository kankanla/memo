<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- https://hakuhin.jp/js/xmlhttprequest.html -->

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta http-equiv="Content-Script-Type" content="text/javascript">
    <title>l7.html</title>
</head>

<body>
    <script type="text/javascript">
        function setCSV() {
            let req = new XMLHttpRequest();
            let url = '/loto7.csv?key=' + Math.floor(Math.random() * (1 - 100) + 100);
            // let url = '/loto7.csv';
            req.onreadystatechange = function () {
                if (req.readyState == 4 && req.status == 200) {
                    vvv(req.responseText);
                }
            }
            req.open("GET", url, true);
            req.send(null);
        }
        setCSV();

        function vvv(str) {
            let tr = str.split('\n');
            let ttable = document.getElementsByTagName('tbody')[0];
            let ttfe = ttable.firstElementChild;
            ttfe = ttfe.nextElementSibling;
            do {
                let tr_data = tr.shift();
                let td_data = tr_data.split(',');
                let ircc = ttfe.cloneNode(true);
                let tr_place = ircc.getElementsByTagName('td');
                for (let i = 0; i <= 13; ++i) {
                    if (i <= 1 || i >= 11) {
                        tr_place[i].innerText = td_data[i];
                    } else {
                        tr_place[i].innerText = parseInt(td_data[i]);
                    }
                }
                ttable.insertBefore(ircc, ttfe);
            } while (tr != '');
            master();
        }

        function master() {
            // すべての抽選数字をarrayに取得
            l7ms = [];
            let li = 0;
            let tb = document.getElementsByTagName('tbody')[0];
            let fc = tb.firstElementChild;
            do {
                l7ms[li] = [];
                let da = fc.getElementsByTagName('td');
                if (da.length > 7) {
                    for (let i = 2; i < 11; i++) {
                        l7ms[li].push(parseInt(da[i].innerText));
                    }
                    li++;
                }
            } while (fc = fc.nextElementSibling);
            return l7ms;
        }

        function cc() {
            let fincol = document.getElementsByClassName('setColor');
            for (let i = 0; i < fincol.length; i++) {
                fincol[i].removeAttribute('style');
            }
        }

        function fns72(tx7, set3 = 150) {
            // テーブルのアレと比較
            let test = l7ms;
            let vx = 0;
            let contA = 0;
            let contB = 0;
            for (let i = 0; i < test.length; i++) {
                contA = 0;
                for (let j = 0; j < tx7.length; j++) {
                    if (test[i].indexOf(tx7[j]) != -1) {
                        contA++;
                    }
                }
                if (contA >= 3) {
                    contB++;
                }
            }
            if (contB >= set3) {
                console.log('fns7(  [' + tx7 + ']  )' + "  d3c = " + contB);
            }
        }

        function fns7(tx7, set1 = 0, set2 = 0, set3 = 150, set5 = 0) {
            // HTML Table と比較
            set4 = 1;
            let colors = {
                1: '#66FFCC', 2: '#FFCCCC', 3: '#FFCC99', 4: '#FFCC66', 5: '#FFCC33', 6: '#FFCC00', 7: '#FF99FF', 8: '#FF99CC', 9: '#FF9999', 10: '#FF9966', 11: '#FF9933', 12: '#FF9900', 13: '#FF66FF', 14: '#FF66CC', 15: '#FF6699', 16: '#FF6666', 17: '#FF6633', 18: '#FF6600', 19: '#FF33FF', 20: '#FF33CC', 21: '#FF3399', 22: '#FF3366', 23: '#FF3333', 24: '#66FF00', 25: '#FF00FF', 26: '#FF00CC', 27: '#FF0099', 28: '#FF0066', 29: '#FF0033', 30: '#FF0000', 31: '#CC33FF', 32: '#CC33CC', 33: '#CC3399', 34: '#CC3366', 35: '#CC3333', 36: '#CC3300', 37: '#CC00FF', 38: '#CC00CC', 39: '#CC0099', 40: '#CC0066', 41: '#CC0033', 42: '#CC0000', 43: '#9900FF', 44: '#9900CC'
            }
            let tb = document.getElementsByTagName('tbody')[0];
            let fc = tb.firstElementChild;
            let xca = 0;
            let temp = [];
            cc();

            do {
                let trs = fc.getElementsByTagName('td');
                if (trs.length < 3) {
                    break;
                }
                set5--;
                if (set5 >= 0) {
                    continue;
                };
                let xc = 0;
                for (let i = 2; i < 11; i++) {
                    for (let j = 0; j < tx7.length; j++) {
                        if (trs[i].innerText == tx7[j]) {
                            if (temp.indexOf(tx7[j]) == -1) {
                                switch (set4) {
                                    case 1:
                                        trs[i].style.backgroundColor = colors[tx7[j]];
                                        break;
                                    case 2:
                                        let rrgb = 'RGBA(0,0,255,' + (tx7[j] / 100 + 0.3) + ')';
                                        trs[i].style.backgroundColor = rrgb;
                                        break;
                                }
                            }
                            trs[i].setAttribute('class', 'setColor');
                            xc++;
                            if (set1 == 1) {
                                temp.push(tx7[j]);
                            }
                        }

                    }
                }

                if (xc == 3) {
                    trs[0].style.backgroundColor = colors[0];
                    trs[0].setAttribute('class', 'setColor');
                    xca++;
                }

                if (xc == 4) {
                    trs[0].style.backgroundColor = colors[1];
                    trs[0].setAttribute('class', 'setColor');
                    xca++;
                }

                if (xc == 5) {
                    trs[0].style.backgroundColor = colors[2];
                    trs[0].setAttribute('class', 'setColor');
                    xca++;
                }
            } while (fc = fc.nextElementSibling);

            if (xca >= set3) {
                console.log('fns7(  [' + tx7 + ']  )' + "  d3c = " + xca);
            }
        }

        function ck72(tx7, set3 = 150) {
            // fns7([6, 10, 20, 22, 27, 28, 33])  d3c = 162
            console.log(new Date());
            ck72_work = setInterval(function () {
                for (let i = 0; i < 1000; i++) {
                    if (tx7-- >= 0) {
                        let temp = l7(9);
                        fns72(temp, set3);
                    }
                }
                if (tx7 <= 0) {
                    clearInterval(ck72_work);
                    console.log(new Date());
                    console.log('ck72_work_end');
                }
            }, 1);
        }

        function ck7(tx7, set3 = 150) {
            ck7_work = setInterval(function () {
                let temp = l7(9);
                if (tx7 == 1) {
                    console.log('fns7( [' + temp + '] )');
                }
                fns7(temp, 0, 0, set3);
                if (tx7-- == 0) {
                    clearInterval(ck7_work);
                    console.log('ck7_work_end');
                }
            }, 1);
        }

        function l7(tx7 = 9) {
            // ランダムの数字を発生
            // console.log('tx7 =  ' + tx7);
            let j = [];
            do {
                let c = Math.floor(Math.random() * (1 - 66) + 66);
                if (c <= 37) {
                    if (j.indexOf(c) == -1) {
                        j.push(c);
                    }
                }
            } while (j.length < tx7);
            return j.sort((a, b) => a - b);
        }

        function hiro7_view(tx7) {
            // ==t[] までのランダムデータとまる
            // hiro7_item = [9, 19, 22, 32, 35, 36, 37];  //第386回
            hiro7_item = tx7;
            let hiro7_item_string = hiro7_item.sort((a, b) => a - b).toString();
            let i = 0;
            function l7x() {
                let j = [];
                do {
                    let c = Math.floor(Math.random() * (1 - 66) + 66);
                    if (c <= 37) {
                        j.indexOf(c) == -1 ? j.push(c) : '';
                    }
                } while (j.length < hiro7_item.length);
                return j.sort((a, b) => a - b);
            }
            let startT = new Date();
            console.log(startT);

            hiro7_view_work = setInterval(() => {
                for (let li = 0; li < 1000; li++) {
                    let x = l7x();
                    console.log(i++, x);
                    if (hiro7_item_string === x.toString()) {
                        clearInterval(hiro7_view_work);
                        let x = l7x();
                        console.log(i++, x);
                        console.log(startT);
                        console.log(new Date());
                        console.log('hiro7_item  ' + hiro7_item);
                        console.log('Work_Stoped');
                        alert("Work_Stoped");
                    }
                }
            }, 500);
        }

        function roolclock() {
            let rolldata = master();
            let tb = document.getElementsByTagName('tbody')[0];
            let trs = tb.getElementsByTagName('tr');
            let iid = 0;
            for (let i = 0; i < trs.length; i++) {
                trs[i].firstElementChild.addEventListener('click', function () {
                    let temp = [];
                    if (isNaN(this.innerText)) {
                        for (let i = 0; i <= 37; i++) {
                            temp.push(i);
                        }
                        fns7(temp);
                        return;
                    }
                    fnsarray = [];
                    fns7(rolldata[rolldata.length - this.innerText - 1], 0, 0, 1);
                });

                trs[i].firstElementChild.addEventListener('dblclick', function () {
                    let temp = [];
                    if (isNaN(this.innerText)) {
                        for (let i = 0; i <= 37; i++) {
                            temp.push(i);
                        }
                        fns7(temp);
                        return;
                    }
                    fnsarray = [];
                    fns7(rolldata[rolldata.length - this.innerText - 1], 1, 0, 1, rolldata.length - this.innerText);
                });
            }

            var fnsarray = new Array();
            let ns = document.getElementsByClassName('n');
            for (let i = 0; i < ns.length; i++) {
                ns[i].addEventListener('click', function () {
                    let xx = parseInt(this.innerText);
                    if (fnsarray.indexOf(xx) == -1 && !isNaN(xx)) {
                        fnsarray.push(parseInt(this.innerText));
                    } else {
                        let v = fnsarray.indexOf(parseInt(this.innerText));
                        fnsarray.splice(v, 1);
                    }
                    fns7(fnsarray, 0, 0, 0);
                });
            }
        }

        window.addEventListener('beforeunload', function () {
            // console.log('beforeunload');
            // return '本当に離れますか？';
            console.log(this);
            event.preventDefault();
            event.returnValue = '';
        });

        window.addEventListener('load', function () {
            console.log('window.onload');
            roolclock();

            setTimeout(function () {
                console.log("roolclock");
                roolclock();
            }, 1000);

        });

        window.addEventListener('DOMContentLoaded', function () {
            console.log('window.DOMContentLoaded');

        });

        document.addEventListener('DOMContentLoaded', function () {
            console.log('document.DOMContentLoaded');

        });

    </script>
    <table table border="1" cellspacing="0" cellpadding="1" bordercolor="#333333">
        <tr align="right">
            <td>回別</td>
            <td>抽選日</td>
            <td class="n">(x1)</td>
            <td class="n">(x2)</td>
            <td class="n">(x3)</td>
            <td class="n">(x4)</td>
            <td class="n">(x5)</td>
            <td class="n">(x6)</td>
            <td class="n">(x7)</td>
            <td class="n">ボナ1</td>
            <td class="n">ボナ2</td>
            <td>口数</td>
            <td>当選金額</td>
            <td>オーバー</td>
        </tr>
        <tr align="right">
            <td>回別</td>
            <td>抽選日</td>
            <td class="n">(x1)</td>
            <td class="n">(x2)</td>
            <td class="n">(x3)</td>
            <td class="n">(x4)</td>
            <td class="n">(x5)</td>
            <td class="n">(x6)</td>
            <td class="n">(x7)</td>
            <td class="n">ボナ1</td>
            <td class="n">ボナ2</td>
            <td>口数</td>
            <td>当選金額</td>
            <td>オーバー</td>
        </tr>
    </table>
</body>

</html>