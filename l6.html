<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- https://hakuhin.jp/js/xmlhttprequest.html -->

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta http-equiv="Content-Script-Type" content="text/javascript">
    <title>hello.html</title>
</head>

<body>
    <script type="text/javascript">
        const PGtitle = 'l6.html'
        const CSVFile = 'loto6.csv';
        const LMax3743 = 43;
        const LSize76 = 6;
        const LBsize79 = 7;
        function setCSV() {
            let req = new XMLHttpRequest();
            let url = '/' + CSVFile + '?key=' + Math.floor(Math.random() * (1 - 100) + 100);
            req.onreadystatechange = function () {
                if (req.readyState == 4 && req.status == 200) {
                    let ajaxText = req.responseText;
                    master(ajaxText);
                    vvv(ajaxText);
                }
            }
            req.open("GET", url, true);
            req.send(null);
        }
        setCSV();

        function vvv(str) {
            let tr = str.split('\n');
            let ttable = document.getElementsByTagName('tbody')[0];
            let ttfe = ttable.firstElementChild;
            ttfe = ttfe.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling;
            do {
                let tr_data = tr.shift();
                let td_data = tr_data.split(',');
                let ircc = ttfe.cloneNode(true);
                let tr_place = ircc.getElementsByTagName('td');
                let temp = [];
                for (let i = 0; i <= 11; ++i) {
                    if (i <= 1 || i >= 9) {
                        tr_place[i].innerText = td_data[i];
                    } else {
                        tr_place[i].innerText = parseInt(td_data[i]);
                        temp.push(parseInt(td_data[i]));
                    }
                }
                tr_place[12].innerText = fns2(temp, 0, 0);
                temp.pop();
                // temp.pop();
                tr_place[13].innerText = fns2(temp, 0, 0);
                ttable.insertBefore(ircc, ttfe);
            } while (tr != '');
        }

        var G_lms = [];
        function master(str) {
            console.log('master');
            let tr = str.split('\n');
            let ttable = document.getElementsByTagName('tbody')[0];
            let ttfe = ttable.firstElementChild;
            for (let i = 0; i < tr.length; i++) {
                G_lms[i] = [];
                let td = tr[i].split(',');
                for (let j = 2; j < 9; j++) {
                    G_lms[i].push(parseInt(td[j]));
                }
            }
            return G_lms.reverse();
        }

        function master2() {
            // すべての抽選数字をarrayに取得
            G_lms = [];
            let li = 0;
            let tb = document.getElementsByTagName('tbody')[0];
            let fc = tb.firstElementChild;
            do {
                G_lms[li] = [];
                let da = fc.getElementsByTagName('td');
                if (da.length > LBsize79) {
                    for (let i = 2; i < 9; i++) {
                        G_lms[li].push(parseInt(da[i].innerText));
                    }
                    li++;
                }
            } while (fc = fc.nextElementSibling);
            return G_lms.reverse();
        }

        function cc() {
            let fincol = document.getElementsByClassName('setColor');
            for (let i = 0; i < fincol.length; i++) {
                fincol[i].removeAttribute('style');
            }
        }

        function hit_table() {
            let tb = document.getElementById('hide');
            tb.addEventListener('click', function () {
                let tab = document.getElementsByTagName('table')[0];
                if (tab.getAttribute('style') == 'display:none') {
                    // tab.setAttribute('style', '');
                    console.log("document.getElementsByTagName('table')[0].setAttribute('style','')");
                } else {
                    tab.setAttribute('style', 'display:none');
                }
            });
        }

        function fns2(tx, set3 = 150, view = 1) {
            // テーブルのアレと比較
            let test = G_lms.concat();
            let vx = 0;
            let contA = 0;
            let contB = 0;
            for (let i = 0; i < test.length; i++) {
                contA = 0;
                for (let j = 0; j < tx.length; j++) {
                    if (test[i].indexOf(tx[j]) != -1) {
                        contA++;
                    }
                }
                if (contA >= 3) {
                    contB++;
                }
            }
            if (contB >= set3 && view == 1) {
                console.log('fns( [' + tx + '] )' + "  d3c = " + contB);
            }
            return contB;
        }

        function fns(tx, set1 = 0, set2 = 0, set3 = 30, set5 = 0) {
            if (!tx) {
                return;
            }
            // HTML Table と比較
            // http://www.htmq.com/color/websafe216.shtml
            let colors1 = {
                1: '#66FFCC', 2: '#FFCCCC', 3: '#FFCC99', 4: '#FFCC66', 5: '#FFCC33',
                6: '#FFCC00', 7: '#FF99FF', 8: '#FF99CC', 9: '#FF9999', 10: '#FF9966',
                11: '#FF9933', 12: '#FF9900', 13: '#FF66FF', 14: '#FF66CC', 15: '#FF6699',
                16: '#FF6666', 17: '#FF6633', 18: '#FF6600', 19: '#FF33FF', 20: '#FF33CC',
                21: '#FF3399', 22: '#FF3366', 23: '#FF3333', 24: '#66FF00', 25: '#FF00FF',
                26: '#FF00CC', 27: '#FF0099', 28: '#FF0066', 29: '#FF0033', 30: '#FF0000',
                31: '#CC33FF', 32: '#CC33CC', 33: '#CC3399', 34: '#CC3366', 35: '#CC3333',
                36: '#CC3300', 37: '#CC00FF', 38: '#CC00CC', 39: '#CC0099', 40: '#CC0066',
                41: '#CC0033', 42: '#CC0000', 43: '#9900FF', 44: '#9900CC',
            }
            let colors2 = {
                1: '#ffff75', 2: '#ffff70', 3: '#ffff6b', 4: '#ffff5b', 5: '#ffff4c',
                6: '#ffff3d', 7: '#ffff2d', 8: '#ffff1e', 9: '#ffff0f', 10: '#ffff00',
                11: '#75ff75', 12: '#70ff70', 13: '#6bff6b', 14: '#5bff5b', 15: '#4cff4c',
                16: '#3dff3d', 17: '#2dff2d', 18: '#1eff1e', 19: '#0fff0f', 20: '#00ff00',
                21: '#75baff', 22: '#70b7ff', 23: '#6bb5ff', 24: '#5badff', 25: '#4ca5ff',
                26: '#3d9eff', 27: '#2d96ff', 28: '#1e8eff', 29: '#0f87ff', 30: '#007fff',
                31: '#ba75ff', 32: '#b770ff', 33: '#b56bff', 34: '#ad5bff', 35: '#a54cff',
                36: '#9e3dff', 37: '#962dff', 38: '#8e1eff', 39: '#870fff', 40: '#7f00ff',
                41: '#ff7575', 42: '#ff7070', 43: '#ff6b6b', 44: '#ff5b5b', 45: '#ff4c4c',
                46: '#ff3d3d', 47: '#ff2d2d', 48: '#ff1e1e', 49: '#ff0f0f', 50: '#ff0000',
            }

            let colors = {};
            set4 = 2;   // 色の付けモード
            switch (set4) {
                case 1:
                    colors = colors1;
                    break;
                case 2:
                    colors = colors2;
                    break;
                case 3:
                    for (let i = 0; i <= 50; i++) {
                        colors[i] = 'RGBA(0,0,255,' + (i / 100 + 0.3) + ')';
                    }
                    break;
            }

            let tb = document.getElementsByTagName('tbody')[0];
            let fc = tb.firstElementChild;
            let xca = 0;
            let temp = [];
            let temp2 = [];
            cc();

            do {
                let trs = fc.getElementsByTagName('td');
                if (trs.length < 3) {
                    break;
                }
                set5--;
                if (set5 >= 0) {
                    continue;
                };
                let xc = 0;
                for (let i = 2; i < 9; i++) {
                    for (let j = 0; j < tx.length; j++) {
                        if (trs[i].innerText == tx[j]) {
                            if (temp.indexOf(tx[j]) == -1) {
                                trs[i].style.backgroundColor = colors[tx[j]];
                            }
                            trs[i].setAttribute('class', 'n setColor');
                            xc++;
                            if (set1 == 1) {
                                if (temp2.indexOf(tx[j]) == -1) {
                                    temp2.push(tx[j]);
                                } else {
                                    if (temp.indexOf(tx[j]) == -1) {
                                        temp.push(tx[j]);
                                    }
                                }
                            }
                        }
                    }
                }

                switch (xc) {
                    case 3:
                        trs[0].style.backgroundColor = colors[44];
                        trs[0].setAttribute('class', 'setColor');
                        xca++;
                        break;
                    case 4:
                        trs[0].style.backgroundColor = colors[45];
                        trs[0].setAttribute('class', 'setColor');
                        xca++;
                        break;
                    case 5:
                        trs[0].style.backgroundColor = colors[46];
                        trs[0].setAttribute('class', 'setColor');
                        xca++;
                        break;
                    default:
                        if (xc > 5) {
                            xca++;
                        }
                }
            } while (fc = fc.nextElementSibling);

            if (xca >= set3) {
                console.log('fns( [' + tx.concat().sort((a, b) => a - b) + '] )' + '  d3c = ' + xca + ' sort');
                console.log('fns( [' + tx + '] )' + '  d3c = ' + xca);
            }
        }

        function T_cpt2(tx = [0, 0, 0, 0, 0, 0, 0], nid = 5) {
            // T_cpt2() 先頭に予想番号を追加
            let xnid = document.getElementById('nx' + nid);
            let cxnid = xnid.getElementsByClassName('n');
            for (let i = 0; i < cxnid.length; i++) {
                cxnid[i].innerText = tx[i];
            }
            // roolclock();
        }

        function T_ck3(tx, view = 0) {
            // T_ck3() 設定番号除外して予想番号を生成
            let orj = tx;
            let nums = [];
            let nlist = [];
            let count = 0;
            for (let i = 0; i < LMax3743; i++) {
                nums.push(parseInt(i) + 1);
            }

            for (let i = 0; i < orj.length; i++) {
                nums.splice(nums.indexOf(parseInt(orj[i])), 1);
            }
            var flag = 0;
            nlist.push(orj);
            W_ck3 = setInterval(function () {
                for (let j = 0; j < 100; j++) {
                    let tp = ls(LSize76);
                    if (view == 1) {
                        console.log(count++ + '  ' + tp);
                    } else {
                        count++;
                    }
                    for (let i = 0; i < tp.length; i++) {
                        if (nums.indexOf(parseInt(tp[i])) === -1) {
                            flag = 1;
                        }
                    }

                    if (flag == 0) {
                        nlist.push(tp);
                        console.log('nums', nums);
                        console.log(count, tp);
                        tp.forEach(function (e) {
                            nums.splice(nums.indexOf(parseInt(e)), 1);
                        })
                    } else {
                        flag = 0;
                    }
                    if (nums.length <= tp.length) {
                        clearInterval(W_ck3);
                        console.log('nums', nums);
                        nlist.push(nums);
                        // console.log(nlist);
                        console.log(new Date());
                        console.log('count', count);
                        nlist.forEach(function (e) {
                            console.log('fns([' + e + '])');
                        })
                        console.log('W_ck3_stoped');
                        alert("W__ck3_stoped");
                        break;
                    }
                }
            }, 100)
        }

        function T_ck2(tx, set3 = 150) {
            // T_ck2() 予想番号を生成,masterと参照
            // ランダム番号を生成
            // fns([6, 10, 20, 22, 27, 28, 33])  d3c = 162
            console.log(new Date());
            W_ck2 = setInterval(function () {
                for (let i = 0; i < 1000; i++) {
                    if (tx-- >= 0) {
                        let temp = ls(LBsize79);
                        fns2(temp, set3);
                    }
                }
                if (tx <= 0) {
                    clearInterval(W_ck2);
                    console.log(new Date());
                    console.log('W_ck2_end');
                }
            }, 1);
        }

        function T_ck(tx, set3 = 150) {
            // T_ck() 予想番号を生成,htmlと参照
            W_ck = setInterval(function () {
                let temp = ls(LBsize79);
                if (tx == 1) {
                    console.log('fns( [' + temp + '] )');
                }
                fns(temp, 0, 0, set3);
                if (tx-- == 0) {
                    clearInterval(W_ck);
                    console.log('W_ck_end');
                }
            }, 1);
        }

        G_addr = []
        function T_addr(fns) {
            // T_addr() []番号を追加,番号の出番を確認
            // よく表示する数字を割り出す
            G_addr = G_addr.concat(fns);
            G_addr.sort((a, b) => a - b);
            let temp = [];
            for (let j = 0; j <= LMax3743; j++) {
                temp[j] = 0;
            }
            G_addr.forEach(function (e) {
                temp[e] = temp[e] + e + ',';
            });
            if (G_addr.length < 200) {
                temp.forEach(function (e) {
                    if (e != 0) {
                        console.log(e);
                    }
                })
                console.log('fns( [' + G_addr + '])');
                console.log('G_addr=[] reset');
            }
        }

        function ls(tx = LBsize79) {
            // ランダムの数字を発生
            // console.log('tx =  ' + tx);
            let j = [];
            do {
                let c = Math.floor(Math.random() * (1 - 66) + 66);
                if (c <= LMax3743) {
                    if (j.indexOf(c) == -1) {
                        j.push(c);
                    }
                }
            } while (j.length < tx);
            return j.sort((a, b) => a - b);
        }

        function T_ncont() {
            // すべての出番数字の合計
            let table = [];
            if (G_addr.length == 0) {
                for (let i = 0; i < G_lms["length"]; i++) {
                    T_addr(G_lms[i]);
                }
            }

            for (var i = 1; i <= LMax3743; i++) {
                var temp = 0;
                G_addr.forEach(function (e) {
                    if (e == i) {
                        temp++;
                    }
                })
                table[i] = temp;
            }
            console.table(table);
            console.log(table);
        }

        function T_rns(tx) {
            // 番号を回転する。
            let temp = [];
            let ttx = tx.concat();
            for (let i = 0; i <= LMax3743; i++) {
                if (tx[i]) {
                    temp[i] = LMax3743 + 1 - ttx[i];
                }
            }
            console.log('fns( [' + temp + '] )');
        }

        function hiro_view(tx) {
            // ==t[] までのランダムデータとまる
            // hiro_item = [1, 6, 11, 13, 30, 33, 4]
            hiro_item = tx;
            let hiro_item_string = hiro_item.sort((a, b) => a - b).toString();
            let i = 0;
            function lxx() {
                let j = [];
                do {
                    let c = Math.floor(Math.random() * (1 - 66) + 66);
                    if (c <= LMax3743) {
                        j.indexOf(c) == -1 ? j.push(c) : '';
                    }
                } while (j.length < hiro_item.length);
                return j.sort((a, b) => a - b);
            }
            let startT = new Date();
            console.log(startT);
            W_hiro_view = setInterval(() => {
                for (let li = 0; li < 1000; li++) {
                    let x = lxx();
                    console.log(i++, x);
                    if (hiro_item_string === x.toString()) {
                        clearInterval(W_hiro_view);
                        let x = lxx();
                        console.log(i++, x);
                        console.log(startT);
                        console.log(new Date());
                        console.log('hiro_item  ' + hiro_item);
                        console.log('W_hiro_view_Stoped');
                        alert("W_hiro_view_Stoped");
                    }
                }
            }, 500);
        }

        function roolclock() {
            let fadr = [];
            let rolldata = G_lms;
            let tb = document.getElementsByTagName('tbody')[0];
            let trs = tb.getElementsByTagName('tr');
            let iid = 0;
            let cl = function () {
                if (isNaN(this.innerText)) {
                    for (let i = 0; i <= LMax3743; i++) {
                        fadr.push(i);
                    }
                    fns(fadr);
                    return;
                }
                G_fns = [];
                fns(rolldata[this.innerText], 0, 0, 1);
            }

            let dl = function () {
                G_fnsa = [];
                fns(rolldata[this.innerText], 1, 0, 1, rolldata.length - this.innerText + 6);
            }

            let cl2 = function () {
                T_addr(rolldata[this.previousElementSibling.innerText]);
            }

            for (let i = 0; i < trs.length; i++) {
                trs[i].firstElementChild.addEventListener('click', cl, true);
                trs[i].firstElementChild.addEventListener('dblclick', dl, true);
                trs[i].firstElementChild.nextElementSibling.addEventListener('click', cl2, true);
            }

            G_fnsa = new Array();
            let ns = document.getElementsByClassName('n');
            for (let i = 0; i < ns.length; i++) {
                ns[i].addEventListener('click', function () {
                    let xx = parseInt(this.innerText);
                    if (G_fnsa.indexOf(xx) == -1 && !isNaN(xx)) {
                        G_fnsa.push(parseInt(this.innerText));
                    } else {
                        let v = G_fnsa.indexOf(parseInt(this.innerText));
                        G_fnsa.splice(v, 1);
                    }
                    fns(G_fnsa, 0, 0, 0);
                });
            }
        }

        function T_ff(num) {
            // T_ff() 予想番号を複数入力し,未使用番号を割り出す
            let tempar = num.concat();
            let tt = [];
            for (let i = 1; i <= LMax3743; i++) {
                tt.push(i);
            }
            let temp = tt.filter(function (ia) {
                if (tempar.indexOf(ia) == -1) {
                    return ia;
                }
            })
            console.log('fns([' + temp + '])  未選択番号');
        }

        function help() {
            console.log('G_addr:', '選択番号複数');
            console.log('G_fnsa:', '選択番号1個追加');
            console.log('G_lms:', 'master');
            console.log('fns():', 'htmlと参照');
            console.log('fns2():', 'masterと参照');
            console.log('T_addr():', '[]番号を追加,番号の出番を確認');
            console.log('T_ck():', '予想番号を生成,htmlと参照');
            console.log('T_ck2():', '予想番号を生成,masterと参照');
            console.log('T_ck3():', '設定番号除外して予想番号を生成');
            console.log('T_cpt2():', '先頭に予想番号を追加');
            console.log('T_ff():', '予想番号を複数入力し,未使用番号を割り出す');
            console.log('T_ncont():', 'すべての出番数字の合計');
            console.log('hiro_view():', '指定番号までのランダムデータとまる');
        }

        window.addEventListener('beforeunload', function () {
            // console.log('beforeunload');
            // return '本当に離れますか？';
            console.log(this);
            event.preventDefault();
            event.returnValue = '';
        });

        window.addEventListener('load', function () {
            console.log('window.onload');
            document.title = PGtitle;
            hit_table();
            setTimeout(function () {
                console.log('roolclock');
                roolclock();
            }, 1000);
            help();
        });

        window.addEventListener('DOMContentLoaded', function () {
            console.log('window.DOMContentLoaded');
        });

        document.addEventListener('DOMContentLoaded', function () {
            console.log('document.DOMContentLoaded');
        });

    </script>
    <Button id="hide">style</Button>
    <table table border="1" cellspacing="0" cellpadding="1" bordercolor="#333333" style="display:''">
        <tr align="right">
            <td>回別</td>
            <td>抽選日</td>
            <td class="n">(x1)</td>
            <td class="n">(x2)</td>
            <td class="n">(x3)</td>
            <td class="n">(x4)</td>
            <td class="n">(x5)</td>
            <td class="n">(x6)</td>
            <td class="n">ボナ</td>
            <td>口数</td>
            <td>当選金額</td>
            <td>オバ</td>
            <td>レ7</td>
            <td>レ6</td>
        </tr>
        <tr id=nx1 align="right">
            <td>000</td>
            <td>2020/1/1</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td>0</td>
            <td>nx1</td>
            <td>0</td>
            <td>レ7</td>
            <td>レ6</td>
        </tr>
        <tr id=nx2 align="right">
            <td>000</td>
            <td>2020/1/1</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td>0</td>
            <td>nx2</td>
            <td>0</td>
            <td>レ7</td>
            <td>レ6</td>
        </tr>
        <tr id=nx3 align="right">
            <td>000</td>
            <td>2020/1/1</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td>0</td>
            <td>nx3</td>
            <td>0</td>
            <td>レ7</td>
            <td>レ6</td>
        </tr>
        <tr id=nx4 align="right">
            <td>000</td>
            <td>2020/1/1</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td>0</td>
            <td>nx4</td>
            <td>0</td>
            <td>レ7</td>
            <td>レ6</td>
        </tr>
        <tr id=nx5 align="right">
            <td>000</td>
            <td>2020/1/1</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td class="n">0</td>
            <td>0</td>
            <td>nx5</td>
            <td>0</td>
            <td>レ7</td>
            <td>レ6</td>
        </tr>
        <tr align="right">
            <td>回別</td>
            <td>抽選日</td>
            <td class="n">(x1)</td>
            <td class="n">(x2)</td>
            <td class="n">(x3)</td>
            <td class="n">(x4)</td>
            <td class="n">(x5)</td>
            <td class="n">(x6)</td>
            <td class="n">ボナ</td>
            <td>口数</td>
            <td>当選金額</td>
            <td>オバ</td>
            <td>レ7</td>
            <td>レ6</td>
        </tr>
    </table>
</body>

</html>